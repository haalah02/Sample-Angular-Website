{"ast":null,"code":"import { BehaviorSubject } from \"rxjs\";\nimport { map, distinctUntilChanged, tap, shareReplay } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./jwt.service\";\nimport * as i3 from \"@angular/router\";\nexport class UserService {\n  constructor(http, jwtService, router) {\n    this.http = http;\n    this.jwtService = jwtService;\n    this.router = router;\n    this.currentUserSubject = new BehaviorSubject(null);\n    this.currentUser = this.currentUserSubject.asObservable().pipe(distinctUntilChanged());\n    this.isAuthenticated = this.currentUser.pipe(map(user => !!user));\n  }\n  login(credentials) {\n    return this.http.post(\"/users/login\", {\n      user: credentials\n    }).pipe(tap(({\n      user\n    }) => this.setAuth(user)));\n  }\n  register(credentials) {\n    return this.http.post(\"/users\", {\n      user: credentials\n    }).pipe(tap(({\n      user\n    }) => this.setAuth(user)));\n  }\n  logout() {\n    this.purgeAuth();\n    void this.router.navigate([\"/\"]);\n  }\n  getCurrentUser() {\n    return this.http.get(\"/user\").pipe(tap({\n      next: ({\n        user\n      }) => this.setAuth(user),\n      error: () => this.purgeAuth()\n    }), shareReplay(1));\n  }\n  update(user) {\n    return this.http.put(\"/user\", {\n      user\n    }).pipe(tap(({\n      user\n    }) => {\n      this.currentUserSubject.next(user);\n    }));\n  }\n  setAuth(user) {\n    this.jwtService.saveToken(user.token);\n    this.currentUserSubject.next(user);\n  }\n  purgeAuth() {\n    this.jwtService.destroyToken();\n    this.currentUserSubject.next(null);\n  }\n}\nUserService.ɵfac = function UserService_Factory(t) {\n  return new (t || UserService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.JwtService), i0.ɵɵinject(i3.Router));\n};\nUserService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserService,\n  factory: UserService.ɵfac,\n  providedIn: \"root\"\n});","map":{"version":3,"mappings":"AACA,SAAqBA,eAAe,QAAQ,MAAM;AAGlD,SAASC,GAAG,EAAEC,oBAAoB,EAAEC,GAAG,EAAEC,WAAW,QAAQ,gBAAgB;;;;;AAM5E,OAAM,MAAOC,WAAW;EAQtBC,YACmBC,IAAgB,EAChBC,UAAsB,EACtBC,MAAc;IAFd,SAAI,GAAJF,IAAI;IACJ,eAAU,GAAVC,UAAU;IACV,WAAM,GAANC,MAAM;IAVjB,uBAAkB,GAAG,IAAIT,eAAe,CAAc,IAAI,CAAC;IAC5D,gBAAW,GAAG,IAAI,CAACU,kBAAkB,CACzCC,YAAY,EAAE,CACdC,IAAI,CAACV,oBAAoB,EAAE,CAAC;IAExB,oBAAe,GAAG,IAAI,CAACW,WAAW,CAACD,IAAI,CAACX,GAAG,CAAEa,IAAI,IAAK,CAAC,CAACA,IAAI,CAAC,CAAC;EAMlE;EAEHC,KAAK,CAACC,WAGL;IACC,OAAO,IAAI,CAACT,IAAI,CACbU,IAAI,CAAiB,cAAc,EAAE;MAAEH,IAAI,EAAEE;IAAW,CAAE,CAAC,CAC3DJ,IAAI,CAACT,GAAG,CAAC,CAAC;MAAEW;IAAI,CAAE,KAAK,IAAI,CAACI,OAAO,CAACJ,IAAI,CAAC,CAAC,CAAC;EAChD;EAEAK,QAAQ,CAACH,WAIR;IACC,OAAO,IAAI,CAACT,IAAI,CACbU,IAAI,CAAiB,QAAQ,EAAE;MAAEH,IAAI,EAAEE;IAAW,CAAE,CAAC,CACrDJ,IAAI,CAACT,GAAG,CAAC,CAAC;MAAEW;IAAI,CAAE,KAAK,IAAI,CAACI,OAAO,CAACJ,IAAI,CAAC,CAAC,CAAC;EAChD;EAEAM,MAAM;IACJ,IAAI,CAACC,SAAS,EAAE;IAChB,KAAK,IAAI,CAACZ,MAAM,CAACa,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;EAClC;EAEAC,cAAc;IACZ,OAAO,IAAI,CAAChB,IAAI,CAACiB,GAAG,CAAiB,OAAO,CAAC,CAACZ,IAAI,CAChDT,GAAG,CAAC;MACFsB,IAAI,EAAE,CAAC;QAAEX;MAAI,CAAE,KAAK,IAAI,CAACI,OAAO,CAACJ,IAAI,CAAC;MACtCY,KAAK,EAAE,MAAM,IAAI,CAACL,SAAS;KAC5B,CAAC,EACFjB,WAAW,CAAC,CAAC,CAAC,CACf;EACH;EAEAuB,MAAM,CAACb,IAAmB;IACxB,OAAO,IAAI,CAACP,IAAI,CAACqB,GAAG,CAAiB,OAAO,EAAE;MAAEd;IAAI,CAAE,CAAC,CAACF,IAAI,CAC1DT,GAAG,CAAC,CAAC;MAAEW;IAAI,CAAE,KAAI;MACf,IAAI,CAACJ,kBAAkB,CAACe,IAAI,CAACX,IAAI,CAAC;IACpC,CAAC,CAAC,CACH;EACH;EAEAI,OAAO,CAACJ,IAAU;IAChB,IAAI,CAACN,UAAU,CAACqB,SAAS,CAACf,IAAI,CAACgB,KAAK,CAAC;IACrC,IAAI,CAACpB,kBAAkB,CAACe,IAAI,CAACX,IAAI,CAAC;EACpC;EAEAO,SAAS;IACP,IAAI,CAACb,UAAU,CAACuB,YAAY,EAAE;IAC9B,IAAI,CAACrB,kBAAkB,CAACe,IAAI,CAAC,IAAI,CAAC;EACpC;;AAhEWpB,WAAW;mBAAXA,WAAW;AAAA;AAAXA,WAAW;SAAXA,WAAW;EAAA2B,SAAX3B,WAAW;EAAA4B,YADE;AAAM","names":["BehaviorSubject","map","distinctUntilChanged","tap","shareReplay","UserService","constructor","http","jwtService","router","currentUserSubject","asObservable","pipe","currentUser","user","login","credentials","post","setAuth","register","logout","purgeAuth","navigate","getCurrentUser","get","next","error","update","put","saveToken","token","destroyToken","factory","providedIn"],"sourceRoot":"","sources":["/Users/haalahibrahim/Desktop/Sample-Angular-Website/src/app/core/services/user.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\nimport { Observable, BehaviorSubject } from \"rxjs\";\n\nimport { JwtService } from \"./jwt.service\";\nimport { map, distinctUntilChanged, tap, shareReplay } from \"rxjs/operators\";\nimport { HttpClient } from \"@angular/common/http\";\nimport { User } from \"../models/user.model\";\nimport { Router } from \"@angular/router\";\n\n@Injectable({ providedIn: \"root\" })\nexport class UserService {\n  private currentUserSubject = new BehaviorSubject<User | null>(null);\n  public currentUser = this.currentUserSubject\n    .asObservable()\n    .pipe(distinctUntilChanged());\n\n  public isAuthenticated = this.currentUser.pipe(map((user) => !!user));\n\n  constructor(\n    private readonly http: HttpClient,\n    private readonly jwtService: JwtService,\n    private readonly router: Router\n  ) {}\n\n  login(credentials: {\n    email: string;\n    password: string;\n  }): Observable<{ user: User }> {\n    return this.http\n      .post<{ user: User }>(\"/users/login\", { user: credentials })\n      .pipe(tap(({ user }) => this.setAuth(user)));\n  }\n\n  register(credentials: {\n    username: string;\n    email: string;\n    password: string;\n  }): Observable<{ user: User }> {\n    return this.http\n      .post<{ user: User }>(\"/users\", { user: credentials })\n      .pipe(tap(({ user }) => this.setAuth(user)));\n  }\n\n  logout(): void {\n    this.purgeAuth();\n    void this.router.navigate([\"/\"]);\n  }\n\n  getCurrentUser(): Observable<{ user: User }> {\n    return this.http.get<{ user: User }>(\"/user\").pipe(\n      tap({\n        next: ({ user }) => this.setAuth(user),\n        error: () => this.purgeAuth(),\n      }),\n      shareReplay(1)\n    );\n  }\n\n  update(user: Partial<User>): Observable<{ user: User }> {\n    return this.http.put<{ user: User }>(\"/user\", { user }).pipe(\n      tap(({ user }) => {\n        this.currentUserSubject.next(user);\n      })\n    );\n  }\n\n  setAuth(user: User): void {\n    this.jwtService.saveToken(user.token);\n    this.currentUserSubject.next(user);\n  }\n\n  purgeAuth(): void {\n    this.jwtService.destroyToken();\n    this.currentUserSubject.next(null);\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}